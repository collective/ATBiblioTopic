<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">
<body>

<metal:main fill-slot="main">
    <tal:main-macro metal:define-macro="main">

        <div metal:use-macro="here/document_actions/macros/document_actions">
            Document actions (print, sendto etc)
        </div>

        <h1 tal:content="here/title_or_id" class="documentFirstHeading">
          Title or id
        </h1>

        <div metal:use-macro="here/document_byline/macros/byline">
          Get the byline - contains details about author and modification date.
        </div>

        <div class="documentDescription"
             tal:content="here/Description">
            description
        </div>

        <metal:listing define-macro="biliotopic-listing"
                    tal:define="
			    structural_layout here/getStructuralLayout;
			    structural_layout_reverse here/getStructuralLayoutReverseOrder;
			    search_result python:here.queryCatalog(structural_layout=structural_layout, structural_layout_reverse=structural_layout_reverse);
                            structural_refs python:here.getStructuralLayoutRefs(search_result, structural_layout=structural_layout, structural_layout_reverse=structural_layout_reverse);
                            style here/getPresentationStyle;
                            list_layout here/getListingLayout|nothing;
                            t_link here/getLinkToOriginalRef;
                            t_link_owner here/getLinkToOriginalRefOnlyIfOwner;
                            bs_tool here/portal_bibliostyles;
			    types_tool here/portal_types;">
		    
	<tal:loop tal:repeat="refs structural_refs">
	
	<h3 tal:condition="python: (len(structural_refs) > 1) and (structural_layout != 'portal_type')" tal:content="python: refs[0][structural_layout]" />
	<h3 tal:condition="python: (len(structural_refs) > 1) and (structural_layout == 'portal_type')" tal:content="python: here.translate(types_tool.getTypeInfo(refs[0][structural_layout]).Title())" />

	<tal:structural-layout tal:define="formatted_list python:bs_tool.formatList(refs, style, title_link=t_link, title_link_only_if_owner=t_link_owner, brains_object=True, sort=False);">

        <tal:bibliotopic condition="formatted_list">
          <ul tal:condition="python:list_layout=='bulleted'">
            <tal:block repeat="ref formatted_list">
            <li tal:content="structure ref" />
            </tal:block>
          </ul>

          <ol tal:condition="python:list_layout=='ordered'">
            <tal:block repeat="ref formatted_list">
            <li tal:content="structure ref" />
            </tal:block>
          </ol>
    
          <div tal:repeat="ref formatted_list"
               tal:condition="python:list_layout=='lines'">
            <span tal:replace="structure ref" />
          </div>

          <table class="listing" tal:condition="python:list_layout=='table'">
            <thead>
              <tr>
                <th class="nosort" i18n:translate="header_bibrefs_listing">
                  Bibliography References
                </th>
              </tr>
            </thead>
            <tbody>
              <tal:block repeat="ref formatted_list">
              <tr tal:define="oddrow repeat/ref/odd;"
                  tal:attributes="class python:test(oddrow, 'even', 'odd')">
                <td tal:content="structure ref" />
              </tr>
              </tal:block>
            </tbody>
          </table>
        </tal:bibliotopic>

	<br />
	</tal:structural-layout>
	</tal:loop>

        <p class="discreet"
           tal:condition="python: not search_result and (not mtool.checkPermission('ModifyPortalContent', here) or here.listCriteria())"
           i18n:translate="bibliotopic_nothing_listed">
            No bibliographical references have been found for this context.
        </p>

        <p class="discreet"
            tal:condition="python: not here.listCriteria() and mtool.checkPermission('ModifyPortalContent', here)"
            i18n:domain="atcontenttypes"
            i18n:translate="description_no_criteria_in_topic">
                There are currently no criteria on which to search.
                Please add them using the 'criteria' tab.
        </p>

      </metal:listing>
      <metal:body define-macro="folderlisting_macro">
            <tal:subtopics condition="here/hasSubtopics"
                           define="folderContents here/getFolderContents">
                <h2 i18n:domain="atresearchproject"
                    i18n:translate="sub_rplists_heading">
                    Contained Research Project Lists:
                </h2>
                <metal:list metal:use-macro="here/base/macros/folderlisting"/>
            </tal:subtopics>
      </metal:body>

    <div metal:use-macro="here/document_relateditems/macros/relatedItems">
	show related items if they exist
    </div>

    </tal:main-macro>
    
</metal:main>

</body>
</html>

